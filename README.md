# Avito Monitor

## Назначение

С помощью этого монитора вы можете получать оповещения о появлении новых товаров по указанной ссылке на Авито. При
появлении нового товара посылается сообщение через discord webhook или через telegram-бота

## Настройка

### Обязательно

Первым делом создайте в папке с проектом или рядом с exe-шником файл `.env`. В нем нужно указать **ссылку** на страницу,
которая будет мониториться и **задержку** после каждой итерации.

```dotenv
LINKS=https://www.avito.ru/volgograd/hobbi_i_otdyh
DELAY=10000
```

Можно указать сразу несколько ссылок таким образом

```dotenv
LINKS="https://www.avito.ru/test1 https://www.avito.ru/test2"
```

Если нужно получать уведомления в Discord, то укажите это, а также id и token вебхука:

```dotenv
BOT_SOURCE=DISCORD
WEBHOOK_ID=12345678
WEBHOOK_TOKEN=1q2w3e4r5t6y
```

Если вы хотите получать уведомления в телеграме, то вам придется создать своего бота и указать его токен

```dotenv
BOT_SOURCE=TELEGRAM
TELEGRAM_TOKEN=q1w2e3r4t5y6
```

Для начала работы в телеграм-боте надо будет вызвать команду `/start` (после запуска самого монитора где-то у себя,
разумеется). Id чата будет сохранен в файл `./db/chat-ids.db` и будет использоваться для рассылки. Количество чатов
неограниченно

### Опционально

Оповещения отправляются по дефолту при обновлении информации о товаре, и при появлении новых лотов. Это можно
контролировать с помощью данных строчек в `.env` файле

```dotenv
MESSAGE_ON_CHANGE=false
MESSAGE_ON_NEW=true
```

Кроме того, вы можете использовать прокси. Для этого укажите путь к файлу, в котором они записаны в формате `ip:port`.
Путь указывается относительно корня проекта

```dotenv
PROXY=./db/proxy.db
```

Исключайте ненужные результаты с помощью регулярного выражения. Регулярное выражение применяется к заголовку. Вы можете исключить результаты с любой последовательностью символов,
которая там встречается

Кавычки в начале и в конце - не часть регулярного
выражения, не бойтесь их использовать. Не оборачивать регулярку в `/`. К примеру, при поиске видеокарт, вы не
хотите видеть объявления о продаже 1050ti:

```dotenv
EXCEPT="1050[ ]?ti"
```

При работе накапливается много информации, и со временем программа может начать занимать недопустимо много места в памяти. При достижении указанной границы, если бот был запущен командой `npm run watch` (см. далее), программа автоматически перезапустится и начнет все заново.

```dotenv
MEMORY_EDGE=200
```

## Запуск

Независимо от выбранного способа запуска, вам нужно скачать необходимые для работы приложения npm-модули. Это делается вызовом команды `npm i` в директории, в которой лежит `package.json`.

После этого вы можете воспользоваться exe файлом, который находится в релизах, или сделать его самостоятельно командой `npm run exe`

Можно запустить монитор и просто через команду `npm run start`

Для работы с автоматическим перезапуском выполните `npm run watch`.

> **Осторожно!** При неправильных действиях бот будет работать в фоновом режиме и выключить его можно будет только через диспетчер задач. Кроме того, вы можете нечаянно запустить сразу несколько мониторов и получить бан на свой ip 

